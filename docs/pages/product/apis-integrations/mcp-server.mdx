# MCP server

Cube MCP (Model Context Protocol) lets MCP-compatible AI clients connect to Cube over HTTPS using OAuth. You don’t need to run a local MCP server or manage API keys.

<InfoBox>

The MCP server is available on [Premium and Enterprise plans](https://cube.dev/pricing).

</InfoBox>

## What is MCP?

Model Context Protocol (MCP) is an open standard that enables AI assistants to securely connect to external data sources and tools. The Cube MCP Server acts as a bridge between your AI assistant and Cube's analytics platform, allowing you to ask data questions directly from your coding environment.


## Tools available

- `chat`: Interactive chat with Cube AI agent for analytics and data exploration with streaming real-time responses

## Remote MCP overview

- **Endpoint:** `https://<cube-mcp-server-host>/api/mcp`
- **OAuth discovery:** `https://<cube-mcp-server-host>/.well-known/oauth`
- **OAuth flow:** Authorization Code + PKCE, `client_id` = `cube-mcp-client`, scope = `mcp-agent-access`
- **Agent selection:** Uses the **Remote MCP Defaults** (default deployment + agent) set by your admin

## Admin setup

### Prerequisites

Before enabling Remote MCP, make sure you have:

- **Admin privileges** in your Cube instance
- An active Cube tenant
- Remote MCP URL configured

### 1) Confirm Remote MCP URL

Remote MCP uses your Cube MCP server host. If the URL isn’t configured, the Remote MCP page will show “Remote MCP configuration is unavailable.”

### 2) Set Remote MCP Defaults

Go to <Btn>Admin → Remote MCP</Btn> and select:

- **Default Deployment**
- **Default Agent**

These defaults are required for the OAuth token exchange.

### 3) Copy the Remote MCP Endpoint

Use the **Remote MCP Endpoint** shown on the same page when configuring clients.

## Client setup

### Generic setup

1. In your MCP client, add a new server with the **Remote MCP Endpoint**.
2. The client will auto-discover OAuth and prompt for authentication.
3. Complete the OAuth flow to grant access to your Cube deployment.

### Claude (Team/Enterprise)

1. Open Settings in Claude (web or desktop).
2. Scroll to **Integrations** and click **Add more**.
3. Use:
   - **Integration name:** Cube MCP
   - **Integration URL:** `https://<cube-mcp-server-host>/api/mcp`
4. Enable tools in any new chats.

### Claude (Desktop app)

```json
{
  "mcpServers": {
    "cube-mcp-server": {
      "command": "npx",
      "args": ["-y", "mcp-remote", "--transport", "http", "https://<cube-mcp-server-host>/api/mcp"]
    }
  }
}
```

### Claude Code

```bash
claude mcp add --transport http cube-mcp-server https://<cube-mcp-server-host>/api/mcp
```

Then run `/mcp` inside a Claude Code session to complete authentication.

### Cursor

```json
{
  "mcpServers": {
    "cube-mcp-server": {
      "command": "npx",
      "args": ["-y", "mcp-remote", "--transport", "http", "https://<cube-mcp-server-host>/api/mcp"]
    }
  }
}
```

### Codex

Preferred (CLI):

```bash
codex mcp add cube-mcp-server --url https://<cube-mcp-server-host>/api/mcp
```

If this is your first time using MCP in Codex, enable the feature in `~/.codex/config.toml`:

```editorconfig
[features]
rmcp_client = true
```

Manual setup:

```editorconfig
[features]
rmcp_client = true

[mcp_servers."cube-mcp-server"]
url = "https://<cube-mcp-server-host>/api/mcp"
```

Then run `codex mcp login cube-mcp-server` to authenticate.

### Visual Studio Code

Run this as a Command (stdio) when adding an MCP server:

```bash
npx mcp-remote --transport http https://<cube-mcp-server-host>/api/mcp
```

### Windsurf

```json
{
  "mcpServers": {
    "cube-mcp-server": {
      "command": "npx",
      "args": ["-y", "mcp-remote", "--transport", "http", "https://<cube-mcp-server-host>/api/mcp"]
    }
  }
}
```

### Zed

```json
{
  "context_servers": {
    "cube-mcp-server": {
      "command": {
        "path": "npx",
        "args": ["-y", "mcp-remote", "--transport", "http", "https://<cube-mcp-server-host>/api/mcp"],
        "env": {}
      },
      "settings": {}
    }
  }
}
```

> For the full, UI-tailored instructions per client, see <Btn>Admin → Remote MCP</Btn> and pick a client from **AI Clients**.

## Usage examples

Once configured, ask natural language questions about your data:

- _Show me revenue trends for the last 6 months_
- _What are our top-performing products this quarter?_
- _How does customer acquisition compare year-over-year?_

The server will stream real-time analytics responses with data visualizations and SQL queries.

## Troubleshooting

- **Remote MCP configuration is unavailable**: Configure the Remote MCP URL.
- **Remote MCP OAuth integration is not configured**: Enable MCP in <Btn>Admin → Team & Security → OAuth Integrations</Btn>.
- **Remote MCP defaults are not configured**: Set defaults in <Btn>Admin → Remote MCP</Btn> under **Remote MCP Defaults**.
- **redirect_uri is not allowed**: For self-hosted or custom clients, update `MCP_ALLOWED_REDIRECT_PATTERNS` on console-server.

## Local MCP server

The local MCP server runs on the client and talks directly to the Chat API using an API key. Use this when you need a local setup instead of Remote MCP.

### Required parameters

- **`CUBE_CHAT_API_URL`**: Full Chat API URL from your agent settings.
- **`CUBE_API_KEY`**: API key from <Btn>Admin → API Keys</Btn>.
- **User identity** (choose one):
  - **`INTERNAL_USER_ID`**: Email address of an existing Cube user (uses their existing permissions).
  - **`EXTERNAL_USER_ID`**: Unique ID for external users (use when you need custom attributes or row-level security).

### Chat API URL

The endpoint has the following structure:

```
https://ai.{cloudRegion}.cubecloud.dev/api/v1/public/{accountName}/agents/{agentId}/chat/stream-chat-state
```

Copy the exact Chat API URL from your agent settings (**Chat API URL** field) in <Btn>Admin → Agents</Btn>.

### Example config (local MCP)

#### For internal Cube users

Existing Cube users authenticated by their email address. They use their configured permissions and settings from Cube.

```json
{
  "mcpServers": {
    "cube-mcp-server": {
      "command": "npx",
      "args": ["@cube-dev/mcp-server"],
      "env": {
        "CUBE_CHAT_API_URL": "https://ai.{cloudRegion}.cubecloud.dev/api/v1/public/{accountName}/agents/{agentId}/chat/stream-chat-state",
        "CUBE_API_KEY": "your_api_key_here",
        "INTERNAL_USER_ID": "analyst@yourcompany.com"
      }
    }
  }
}
```
