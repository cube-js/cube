---
redirect_from:
  - /rest-api
---

# REST API reference

The [REST API][ref-rest-api] provides the following endpoints.

<InfoBox>

The `{base_path}` part of the endpoint URLs can be [configured][ref-basepath].
By default, it's `/cubejs-api`.

</InfoBox>

## `{base_path}/v1/load`

Get the data for a query.

| Parameter   | Description                                                                                                           |
| ----------- | --------------------------------------------------------------------------------------------------------------------- |
| `query`     | Either a single URL encoded Cube [Query](/product/apis-integrations/rest-api/query-format), or an array of queries    |
| `queryType` | If multiple queries are passed in `query` for [data blending][ref-recipes-data-blending], this must be set to `multi` |

Response

- `query` - The query passed via params. It can be an array of queries and in
  such case it will be treated as a [Data Blending][ref-recipes-data-blending]
  query.
- `data` - Formatted dataset of query results.
- `annotation` - Metadata for query. Contains descriptions for all query items.
  - `title` - Human readable title from the data model.
  - `shortTitle` - Short title for visualization usage (ex. chart overlay)
  - `type` - Data type
- `total` - The total number of rows returned for the query. Useful for
  paginating results.

Example request:

```bash
# Request with http method GET
curl \
  -H "Authorization: EXAMPLE-API-TOKEN" \
  -G \
  --data-urlencode 'query={"measures":["users.count"]}' \
  http://localhost:4000/cubejs-api/v1/load

# Request with http method POST
# Use POST to fix problem with query length limits
curl \
 -X POST  \
 -H "Content-Type: application/json" \
 -H "Authorization: EXAMPLE-API-TOKEN" \
 --data '{"query": {"measures":["users.count"]}}' \
 http://localhost:4000/cubejs-api/v1/load
```

Example response:

```json
{
  "query": {
    "measures": ["users.count"],
    "filters": [],
    "timezone": "UTC",
    "dimensions": [],
    "timeDimensions": []
  },
  "data": [
    {
      "users.count": "700"
    }
  ],
  "annotation": {
    "measures": {
      "users.count": {
        "title": "Users Count",
        "shortTitle": "Count",
        "type": "number"
      }
    },
    "dimensions": {},
    "segments": {},
    "timeDimensions": {}
  }
}
```

<WarningBox>

Currently all fetched numericals are returned in the same format as driver
returns it without any additional processing. Most of drivers return numerical
values as strings instead of javascript integer or float to ensure there's no
loss of significance. Client code should take care of parsing such numerical
values.

</WarningBox>

## `{base_path}/v1/sql`

Takes an API query and returns the SQL query that can be executed against the data source
that is generated by Cube. This endpoint is useful for debugging, understanding how
Cube translates API queries into SQL queries, and providing transparency to SQL-savvy
end users.

Using this endpoint to take the SQL query and execute it against the data source directly
is not recommended  as it bypasses Cube's caching layer and other optimizations.

Request parameters:

| Parameter, type | Description | Required |
| --- | --- | --- |
| `format`, `string` | Query format:<br/>`sql` for [SQL API][ref-sql-api] queries,<br/>`rest` for [REST API][ref-rest-api] queries (default) | ❌ No |
| `query`, `string` | Query as an URL-encoded JSON object or SQL query | ✅ Yes |
| `disable_post_processing`, `boolean` | Flag that affects query planning, `true` or `false` | ❌ No |

If `disable_post_processing` is set to `true`, Cube will try to generate the SQL
as if the query is run without [post-processing][ref-query-wpp], i.e., if it's run as a
query with [pushdown][ref-query-wpd].

The response will contain a JSON object with the following properties under the `sql` key:

| Property, type | Description |
| --- | --- |
| `status`, `string` | Query planning status, `ok` or `error` |
| `sql`, `array` | Two-element array (see below) |
| `sql[0]`, `string` | Generated query with parameter placeholders |
| `sql[1]`, <nobr>`array` or `object`</nobr> | Generated query parameters |

For queries with the `sql` format, the response will also include the following additional
properties under the `sql` key:

| Property, type | Description |
| --- | --- |
| `query_type`, `string` | `regular` for [regular][ref-regular-queries] queries,<br/>`post_processing` for queries with [post-processing][ref-query-wpp],<br/>`pushdown` for queries with [pushdown][ref-query-wpd] |

For queries with the `sql` format, in case of an error, the response will only contain
`status`, `query_type`, and `error` properties.

For example, an error will be returned if `disable_post_processing` was set to `true` but
the query can't be run without post-processing.

### Example

Request with a query in the REST API format:

```bash
curl \
  -H "Authorization: TOKEN" \
  -G \
  --data-urlencode 'query={"measures":["orders.count"]}' \
  --data-urlencode 'format=rest'  \
  http://localhost:4000/cubejs-api/v1/sql
```

Response:

```json
{
  "sql": {
    "sql": [
      "SELECT sum(`base_orders__count`) `orders__count` FROM prod_pre_aggregations.base_orders_orders_by_month AS `base_orders__orders_by_month`  LIMIT 10000",
      []
    ]
  }
}
```

Request with a query in the SQL API format:

```bash
curl \
  -H "Authorization: TOKEN" \
  -G \
  --data-urlencode 'query=SELECT COUNT(*) FROM orders' \
  --data-urlencode 'format=sql'  \  
  http://localhost:4000/cubejs-api/v1/sql
```

Response:

```json
{
  "sql": {
    "status": "ok",
    "sql": [
      "SELECT\n      count(\"base_orders\".id) \"count_uint8_1__\"\n    FROM\n      (SELECT * FROM 's3://cube-tutorial/orders.csv') AS \"base_orders\"  LIMIT 50000",
      []
    ],
    "query_type": "regular"
  }
}
```

Request with a query in the SQL API format that is executed with post-processing:

```bash
curl \
  -H "Authorization: TOKEN" \
  -G \
  --data-urlencode 'query=SELECT AVG(count) FROM (SELECT COUNT(*) AS count FROM orders) AS table' \
  --data-urlencode 'format=sql'  \ 
  http://localhost:4000/cubejs-api/v1/sql
```

Response:

```json
{
  "sql": {
    "status": "error",
    "error": "Provided query can not be executed without post-processing.",
    "query_type": "post_processing"
  }
}
```

Request with a query in the SQL API format that is forced to be executed without
post-processing, i.e., as a query with pushdown:

```bash
curl \
  -H "Authorization: TOKEN" \
  -G \
  --data-urlencode 'query=SELECT AVG(count) FROM (SELECT COUNT(*) AS count FROM orders) AS table' \
  --data-urlencode 'format=sql' \
  --data-urlencode 'disable_post_processing=true'  \
  http://localhost:4000/cubejs-api/v1/sql
```

Response:

```json
{
  "sql": {
    "status": "ok",
    "sql": [
      "SELECT \"table\".\"avg_table_count_\" \"avg_table_count_\" \nFROM (\n  SELECT AVG(\"table\".\"count\") \"avg_table_count_\" \n  FROM (\n    SELECT\n          count(\"base_orders\".id) \"count\"\n        FROM\n          (SELECT * FROM 's3://cube-tutorial/orders.csv') AS \"base_orders\" \n  ) AS \"table\"\n) AS \"table\"\nLIMIT 50000",
      []
    ],
    "query_type": "pushdown"
  }
}
```

## `{base_path}/v1/meta`

Get meta-information for cubes and views defined in the data model. Information about cubes and views with `public: false` will not be returned.

Response

- `cubes` - Array of cubes and views
  - `name` - Codename of the cube/view
  - `type` - Type can be "cube" or "view"
  - `title` - Human-readable cube/view name
  - `meta` - Custom metadata
  - `measures` - Array of measures in this cube/view
  - `dimensions` - Array of dimensions in this cube/view
  - `hierarchies` - Array of hierarchies in this cube
  - `segments` - Array of segments in this cube/view
  - `folders` - Array of folders in this view
  - `connectedComponent` - An integer representing a join relationship. If the same value is returned for two cubes, then there is
    at least one join path between them.

Example request:

```bash
curl \
  -H "Authorization: EXAMPLE-API-TOKEN" \
  -G \
  http://localhost:4000/cubejs-api/v1/meta
```

Example response:

```json
{
  "cubes": [
    {
      "name": "Users",
      "title": "Users",
      "meta": {
          "someKey": "someValue",
          "nested": {
            "someKey": "someValue"
          }
      },
      "connectedComponent": 1,
      "measures": [
        {
          "name": "users.count",
          "title": "Users Count",
          "shortTitle": "Count",
          "aliasName": "users.count",
          "type": "number",
          "aggType": "count",
          "drillMembers": ["users.id", "users.city", "users.createdAt"]
        }
      ],
      "dimensions": [
        {
          "name": "users.city",
          "title": "Users City",
          "type": "string",
          "aliasName": "users.city",
          "shortTitle": "City",
          "suggestFilterValues": true
        }
      ],
      "segments": []
    }
  ]
}
```

## `{base_path}/v1/pre-aggregations/jobs`

Trigger pre-aggregation build jobs or retrieve statuses of such jobs.

### Triggering jobs

| Parameter                  | Description                                                    | Required |
| -------------------------- | -------------------------------------------------------------- | -------- |
| `action`                   | Use `post` to trigger jobs                                     | ✅       |
| `selector.contexts`        | Array of objects, each containing a `securityContext`          | ✅       |
| `selector.timezones`       | Array of timezones                                             | ✅       |
| `selector.datasources`     | Array of data source names which have pre-aggregations defined | ❌       |
| `selector.cubes`           | Array of cube names which contain pre-aggregations             | ❌       |
| `selector.preAggregations` | Array of pre-aggregation names                                 | ❌       |
| `selector.dateRange`       | Date Range tuple ['range-date-start', 'range-date-end']        | ❌       |

To trigger pre-aggregation builds, send a `POST` request with a payload
including `post` as the `action` and `selector` properties. The response will
contain an array of `tokens` (identifiers) of triggered jobs.

Example request triggering builds of all pre-aggregations defined in all cubes
using an empty security context and a `UTC` timezone:

```bash
curl \
  -d '{
    "action": "post",
    "selector": {
      "contexts": [{ "securityContext": {} }],
      "timezones": ["UTC"]
    }
  }' \
  -H "Authorization: EXAMPLE-API-TOKEN" \
  -H "Content-Type: application/json" \
  -X POST \
  https://localhost:4000/cubejs-api/v1/pre-aggregations/jobs
```

Example request triggering builds of all pre-aggregations defined in the
`orders` cube using an empty security context and a `UTC` timezone:

```bash
curl \
  -d '{
    "action": "post",
    "selector": {
      "contexts": [{ "securityContext": {} }],
      "timezones": ["UTC"],
      "cubes": ["orders"]
    }
  }' \
  -H "Authorization: EXAMPLE-API-TOKEN" \
  -H "Content-Type: application/json" \
  -X POST \
  https://localhost:4000/cubejs-api/v1/pre-aggregations/jobs
```

Example request triggering builds of the `main` pre-aggregation defined in the
`orders` cube using an empty security context and a `UTC` timezone:

```bash
curl \
  -d '{
    "action": "post",
    "selector": {
      "contexts": [{ "securityContext": {} }],
      "timezones": ["UTC"],
      "preAggregations": ["orders.main"]
    }
  }' \
  -H "Authorization: EXAMPLE-API-TOKEN" \
  -H "Content-Type: application/json" \
  -X POST \
  https://localhost:4000/cubejs-api/v1/pre-aggregations/jobs
```

Example request triggering builds of the `main` pre-aggregation defined in the
`orders` cube within date range with some security context data
and an `America/Los_Angeles` timezone:

```bash
curl \
  -d '{
    "action": "post",
    "selector": {
      "contexts": [{ "securityContext": { "tenantId": "tenant1" } }],
      "timezones": ["America/Los_Angeles"],
      "preAggregations": ["orders.main"],
      "dateRange": ["2020-01-01", "2020-02-01"]
    }
  }' \
  -H "Authorization: EXAMPLE-API-TOKEN" \
  -H "Content-Type: application/json" \
  -X POST \
  https://localhost:4000/cubejs-api/v1/pre-aggregations/jobs
```

Example response:

```json
[
  "e9a6a0c55885cea5371348500ce7d7dc",
  "d1329b6c8d152e734fc4dcf7307b1b58",
  "6f4ea38373663fffc4334a576574845b",
  "ea903b10634b2f3141b35a2529870e89"
]
```

### Retrieving statuses of jobs

| Parameter | Description                                                       | Required |
| --------- | ----------------------------------------------------------------- | -------- |
| `action`  | Use `get` to retrieve statuses of previously triggered jobs       | ✅       |
| `tokens`  | Array of `tokens` returned when triggering jobs                   | ✅       |
| `resType` | Use `object` to get a JSON object instead of an array in response | ❌       |

To retrieve statuses of previously triggered jobs, send a `POST` request with a
payload including the `tokens` property.

In the `status` property of the payload, you can get the following statuses:

| Status | Description |
| --- | --- |
| `scheduled` | The job hasn't run yet |
| `processing` | The job is currently running |
| `missing_partition` | The job has failed |
| `done` | The job has successfully completed |

Example request:

```bash
curl \
  -d '{
    "action": "get",
    "tokens": [
      "e9a6a0c55885cea5371348500ce7d7dc",
      "d1329b6c8d152e734fc4dcf7307b1b58"
    ]
  }' \
  -H "Authorization: EXAMPLE-API-TOKEN" \
  -H "Content-Type: application/json" \
  -X POST \
  https://localhost:4000/cubejs-api/v1/pre-aggregations/jobs
```

Example response:

```json
[
  {
    "token": "e9a6a0c55885cea5371348500ce7d7dc",
    "table": "prod_pre_aggregations.orders_category_and_date_hod0x3hf_03krd5ns_1hop3hn",
    "status": "processing",
    "selector": {
      "cubes": ["orders"],
      "preAggregations": ["orders.category_and_date"],
      "contexts": [{ "securityContext": { "tenant": "tenant_1" } }],
      "timezones": ["UTC"],
      "dataSources": ["default"]
    }
  },
  {
    "token": "d1329b6c8d152e734fc4dcf7307b1b58",
    "table": "prod_pre_aggregations.orders_category_and_date_mzfp445f_r2h2isa5_1hop3hn",
    "status": "processing",
    "selector": {
      "cubes": ["orders"],
      "preAggregations": ["orders.category_and_date"],
      "contexts": [{ "securityContext": { "tenant": "tenant_1" } }],
      "timezones": ["UTC"],
      "dataSources": ["default"]
    }
  }
]
```

## `/readyz`

Reports if the deployment has successfully started. To do so, it will try to test
the connection to the _default_ [data source][ref-datasources].

Example of a successful request:

```bash
curl -i http://localhost:4000/readyz
HTTP/1.1 200 OK
X-Powered-By: Express
Access-Control-Allow-Origin: *
Content-Type: application/json; charset=utf-8
Content-Length: 19
ETag: W/"13-MyluqxoYxC0tUxBeZCnbaWYVLhg"
Date: Mon, 18 Jan 2021 15:39:57 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{"health":"HEALTH"}
```

Example of a failed response:

```bash
curl -i http://localhost:4000/readyz
HTTP/1.1 500 Internal Server Error
X-Powered-By: Express
Access-Control-Allow-Origin: *
Content-Type: application/json; charset=utf-8
Content-Length: 19
ETag: W/"13-MyluqxoYxC0tUxBeZCnbaWYVLhg"
Date: Mon, 18 Jan 2021 15:39:57 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{"health":"DOWN"}
```

## `/livez`

Reports if the deployment is still healthy. This is confirmed by testing any
existing connections to data sources.

Example of a successful response:

```bash
curl -i http://localhost:4000/livez
HTTP/1.1 200 OK
X-Powered-By: Express
Access-Control-Allow-Origin: *
Content-Type: application/json; charset=utf-8
Content-Length: 19
ETag: W/"13-MyluqxoYxC0tUxBeZCnbaWYVLhg"
Date: Mon, 18 Jan 2021 15:39:57 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{"health":"HEALTH"}
```

Example of a failed response:

```bash
curl -i http://localhost:4000/livez
HTTP/1.1 500 Internal Server Error
X-Powered-By: Express
Access-Control-Allow-Origin: *
Content-Type: application/json; charset=utf-8
Content-Length: 19
ETag: W/"13-MyluqxoYxC0tUxBeZCnbaWYVLhg"
Date: Mon, 18 Jan 2021 15:39:57 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{"health":"DOWN"}
```

[ref-recipes-data-blending]: /product/data-modeling/concepts/data-blending#data-blending
[ref-rest-api]: /product/apis-integrations/rest-api
[ref-basepath]: /product/apis-integrations/rest-api#base-path
[ref-datasources]: /product/configuration/advanced/multiple-data-sources
[ref-sql-api]: /product/apis-integrations/sql-api
[ref-rest-api]: /product/apis-integrations/rest-api
[ref-data-sources]: /product/configuration/advanced/multiple-data-sources
[ref-regular-queries]: /product/apis-integrations/queries#regular-query
[ref-query-wpp]: /product/apis-integrations/queries#query-with-post-processing
[ref-query-wpd]: /product/apis-integrations/queries#query-with-pushdown
