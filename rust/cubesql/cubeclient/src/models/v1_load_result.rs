/*
 * Cube.js
 *
 * Cube.js Swagger Schema
 *
 * The version of the OpenAPI document: 1.0.0
 *
 * Generated by: https://openapi-generator.tech
 */
use cubeorchestrator::query_result_transform::TransformedData;

#[derive(Clone, Debug, PartialEq, Default, Serialize, Deserialize)]
pub struct V1LoadResult {
    #[serde(rename = "dataSource", skip_serializing_if = "Option::is_none")]
    pub data_source: Option<String>,
    #[serde(rename = "annotation")]
    pub annotation: Box<crate::models::V1LoadResultAnnotation>,
    #[serde(rename = "data")]
    pub data: Vec<serde_json::Value>,
    #[serde(rename = "refreshKeyValues", skip_serializing_if = "Option::is_none")]
    pub refresh_key_values: Option<Vec<serde_json::Value>>,
}

impl V1LoadResult {
    pub fn new(
        annotation: crate::models::V1LoadResultAnnotation,
        data: Vec<serde_json::Value>,
    ) -> V1LoadResult {
        V1LoadResult {
            data_source: None,
            annotation: Box::new(annotation),
            data,
            refresh_key_values: None,
        }
    }
}

impl From<TransformedData> for V1LoadResult {
    fn from(d: TransformedData) -> Self {
        let data = match d {
            TransformedData::Compact {
                members: _members,
                dataset: _dataset,
            } => {
                // TODO V1LoadResult expects only Vanilla results?
                vec![]
            }
            TransformedData::Vanilla(v) => v
                .iter()
                .map(|item| serde_json::to_value(item).unwrap_or(serde_json::Value::Null))
                .collect(),
        };
        let annotation = crate::models::V1LoadResultAnnotation {
            measures: serde_json::Value::Null,
            dimensions: serde_json::Value::Null,
            segments: serde_json::Value::Null,
            time_dimensions: serde_json::Value::Null,
        };
        V1LoadResult {
            data_source: None,
            annotation: Box::new(annotation),
            data,
            refresh_key_values: None,
        }
    }
}
