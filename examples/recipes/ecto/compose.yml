services:
  postgresql:
    container_name: cube_postgresql
    image: docker.io/postgres:alpine
    restart: always
    command: -c 'max_connections=1024' -c 'shared_buffers=32GB'
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - 8432:5432
    volumes:
      - postgresql:/var/lib/postgresql/data

  cube_api:
    container_name: cube_cube_api
    restart: always
    image: cubejs/cube:latest
    ports:
      - 4009:4000
      - 9432:9432
    environment:
      CUBEJS_DB_QUERY_TIMEOUT: 60m
      CUBEJS_CONCURRENCY: 128
      CUBEJS_PG_SQL_PORT: 9432
      CUBEJS_DB_MAX_POOL: 128
      CUBEJS_DB_TYPE: postgres
      CUBEJS_DB_PORT: 5432
      CUBEJS_DB_NAME: pot_examples_dev
      CUBEJS_DB_HOST: postgresql
      CUBEJS_DB_USER: postgres
      CUBEJS_DB_PASS: postgres
      CUBEJS_API_SECRET: secret
      CUBEJS_DEV_MODE: true
      DEBUG_LOG: true
      CUBESQL_LOG_LEVEL: debug
      CUBEJS_LOG_LEVEL: debug
    volumes:
      - ./:/cube/conf

volumes:
  postgresql:
