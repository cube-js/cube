---
cubes:
  - name: mandata_captate
    description: Auto-generated from zhuzha
    sql_table: public.order
    dimensions:
      - meta:
          ecto_field: market_code
          ecto_field_type: string
        name: market_code
        type: string
        sql: market_code
      - meta:
          ecto_field: brand_code
          ecto_field_type: string
        name: brand_code
        type: string
        sql: brand_code
      - meta:
          ecto_field: payment_reference
          ecto_field_type: string
        name: payment_reference
        type: string
        sql: payment_reference
      - meta:
          ecto_field: fulfillment_status
          ecto_field_type: string
        name: fulfillment_status
        type: string
        sql: fulfillment_status
      - meta:
          ecto_field: financial_status
          ecto_field_type: string
        name: financial_status
        type: string
        sql: financial_status
      - meta:
          ecto_field: email
          ecto_field_type: string
        name: email
        type: string
        sql: email
      - meta:
          ecto_field: updated_at
          ecto_field_type: naive_datetime
        name: updated_at
        type: time
        sql: updated_at
      - meta:
          ecto_field: inserted_at
          ecto_field_type: naive_datetime
        name: inserted_at
        type: time
        sql: inserted_at
    measures:
      - name: count
        type: count
      - meta:
          ecto_field: customer_id
          ecto_type: integer
        name: customer_id_sum
        type: sum
        sql: customer_id
      - meta:
          ecto_field: customer_id
          ecto_type: integer
        name: customer_id_distinct
        type: count_distinct
        sql: customer_id
      - meta:
          ecto_field: total_amount
          ecto_type: integer
        name: total_amount_sum
        type: sum
        sql: total_amount
      - meta:
          ecto_field: total_amount
          ecto_type: integer
        name: total_amount_distinct
        type: count_distinct
        sql: total_amount
      - meta:
          ecto_field: tax_amount
          ecto_type: integer
        name: tax_amount_sum
        type: sum
        sql: tax_amount
      - meta:
          ecto_field: tax_amount
          ecto_type: integer
        name: tax_amount_distinct
        type: count_distinct
        sql: tax_amount
      - meta:
          ecto_field: subtotal_amount
          ecto_type: integer
        name: subtotal_amount_sum
        type: sum
        sql: subtotal_amount
      - meta:
          ecto_field: subtotal_amount
          ecto_type: integer
        name: subtotal_amount_distinct
        type: count_distinct
        sql: subtotal_amount
      - meta:
          ecto_field: discount_total_amount
          ecto_type: integer
        name: discount_total_amount_sum
        type: sum
        sql: discount_total_amount
      - meta:
          ecto_field: discount_total_amount
          ecto_type: integer
        name: discount_total_amount_distinct
        type: count_distinct
        sql: discount_total_amount
      - meta:
          ecto_field: delivery_subtotal_amount
          ecto_type: integer
        name: delivery_subtotal_amount_sum
        type: sum
        sql: delivery_subtotal_amount
      - meta:
          ecto_field: delivery_subtotal_amount
          ecto_type: integer
        name: delivery_subtotal_amount_distinct
        type: count_distinct
        sql: delivery_subtotal_amount
    pre_aggregations:
      - name: sums_and_count_daily
        type: rollup
        external: true  # Store in CubeStore for direct access
        measures:
          - mandata_captate.delivery_subtotal_amount_sum
          - mandata_captate.discount_total_amount_sum
          - mandata_captate.subtotal_amount_sum
          - mandata_captate.tax_amount_sum
          - mandata_captate.total_amount_sum
          - mandata_captate.count
        dimensions:
          - mandata_captate.market_code
          - mandata_captate.brand_code
        time_dimension: mandata_captate.updated_at
        granularity: day
        refresh_key:
          every: 1 hour
        build_range_start:
          sql: SELECT DATE('2024-01-01')
        build_range_end:
          sql: SELECT NOW()
      - name: sums_and_count
        type: rollup
        external: true  # Store in CubeStore for direct access
        measures:
          - mandata_captate.delivery_subtotal_amount_sum
          - mandata_captate.discount_total_amount_sum
          - mandata_captate.subtotal_amount_sum
          - mandata_captate.tax_amount_sum
          - mandata_captate.total_amount_sum
          - mandata_captate.count
        dimensions:
          - mandata_captate.market_code
          - mandata_captate.brand_code
          - mandata_captate.financial_status
          - mandata_captate.fulfillment_status
        refresh_key:
          sql: SELECT MAX(id) FROM public.order
